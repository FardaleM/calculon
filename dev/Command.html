<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="next" href="Config.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Command" rel="Chapter" href="Command.html">
<link title="Config" rel="Chapter" href="Config.html">
<link title="Core" rel="Chapter" href="Core.html">
<link title="Lwt_err" rel="Chapter" href="Lwt_err.html">
<link title="Log" rel="Chapter" href="Log.html">
<link title="Plugin" rel="Chapter" href="Plugin.html">
<link title="Prelude" rel="Chapter" href="Prelude.html">
<link title="Signal" rel="Chapter" href="Signal.html">
<link title="Talk" rel="Chapter" href="Talk.html">
<link title="Run_main" rel="Chapter" href="Run_main.html">
<link title="Plugin_factoids" rel="Chapter" href="Plugin_factoids.html">
<link title="Plugin_vote" rel="Chapter" href="Plugin_vote.html">
<link title="Plugin_social" rel="Chapter" href="Plugin_social.html">
<link title="Plugin_state" rel="Chapter" href="Plugin_state.html">
<link title="Plugin_history" rel="Chapter" href="Plugin_history.html"><title>Command</title>
</head>
<body>
<div class="navbar">&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Config.html" title="Config">Next</a>
</div>
<h1>Module <a href="type_Command.html">Command</a></h1>

<pre><span class="keyword">module</span> Command: <code class="code"><span class="keyword">sig</span></code> <a href="Command.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
<h1 id="1_CommandType">Command Type</h1>
<p>

    A command is a particular rule for reacting to what is said on IRC.
    Typically, a command takes a <a href="Core.html#TYPEt"><code class="code"><span class="constructor">Core</span>.t</code></a> (to be able to answer
    and perform IRC actions) and an input message, and it decides
    whether to do something or not based on the message.
<p>

    The command returns a <a href="Command.html#TYPEres"><code class="code"><span class="constructor">Command</span>.res</code></a>, which specifies whether it successfully
    "caught" the message (no need then for other commands to run),
    if it didn't react ("skip") so we can try the other commands,
    or whether it failed when trying to answer.<br>
</div>
<hr width="100%">

<pre><code><span id="TYPEres"><span class="keyword">type</span> <code class="type"></code>res</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTres.Cmd_match"><span class="constructor">Cmd_match</span></span> <span class="keyword">of</span> <code class="type">unit Lwt.t</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
command applies, and fired with given action<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTres.Cmd_skip"><span class="constructor">Cmd_skip</span></span></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
the command did not apply<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTres.Cmd_fail"><span class="constructor">Cmd_fail</span></span> <span class="keyword">of</span> <code class="type">string</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
command applies, but failed<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr></table>



<pre><code><span id="TYPEt"><span class="keyword">type</span> <code class="type"></code>t</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTt.prio">prio</span>&nbsp;: <code class="type">int</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTt.match_">match_</span>&nbsp;: <code class="type"><a href="Core.html#TYPEt">Core.t</a> -> <a href="Core.html#TYPEprivmsg">Core.privmsg</a> -> <a href="Command.html#TYPEres">res</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTt.name">name</span>&nbsp;: <code class="type">string</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTt.descr">descr</span>&nbsp;: <code class="type">string</code>;</code></td>

</tr></table>
}

<div class="info ">
A command, bundling some metadata (name + descr, used for "!help"),
    a priority (used to run some commands before the others),
    and the answering function itself<br>
</div>


<pre><span id="VALmatch_prefix1"><span class="keyword">val</span> match_prefix1</span> : <code class="type">prefix:string -> <a href="Core.html#TYPEprivmsg">Core.privmsg</a> -> string option</code></pre><div class="info ">
<code class="code">match_prefix1 ~prefix:<span class="string">"foo"</span> msg</code>
<p>
<ul>
<li>if <code class="code">msg=<span class="string">"!foo bar"</span></code>, returns <code class="code"><span class="constructor">Some</span> bar</code></li>
<li>if <code class="code">msg=<span class="string">"!something else"</span></code>, returns <code class="code"><span class="constructor">None</span></code></li>
</ul>
<br>
</div>

<pre><span id="VALextract_hl"><span class="keyword">val</span> extract_hl</span> : <code class="type">string -> (string * string) option</code></pre><div class="info ">
<code class="code">extract_hl <span class="string">"foo &gt; bar"</span></code> returns <code class="code"><span class="constructor">Some</span> (<span class="string">"foo"</span>, <span class="string">"bar"</span>)</code>.
    Returns <code class="code"><span class="constructor">None</span></code> if it cannot split on "&gt;" cleanly.<br>
</div>

<pre><span id="VALmatch_prefix1_full"><span class="keyword">val</span> match_prefix1_full</span> : <code class="type">prefix:string -> <a href="Core.html#TYPEprivmsg">Core.privmsg</a> -> (string * string option) option</code></pre>
<pre><span id="VALmake"><span class="keyword">val</span> make</span> : <code class="type">?descr:string -><br>       ?prio:int -><br>       name:string -> (<a href="Core.html#TYPEt">Core.t</a> -> <a href="Core.html#TYPEprivmsg">Core.privmsg</a> -> <a href="Command.html#TYPEres">res</a>) -> <a href="Command.html#TYPEt">t</a></code></pre><div class="info ">
Make a command using the given methods. Only the name and
    matching rules are requested<br>
</div>

<pre><span id="EXCEPTIONFail"><span class="keyword">exception</span> Fail</span> <span class="keyword">of</span> <code class="type">string</code></pre>

<pre><span id="VALmake_simple"><span class="keyword">val</span> make_simple</span> : <code class="type">?descr:string -><br>       ?prio:int -><br>       prefix:string -> (<a href="Core.html#TYPEprivmsg">Core.privmsg</a> -> string -> string option Lwt.t) -> <a href="Command.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">make_simple ~pre f</code> matches messages of the form "!pre xxx",
    and call <code class="code">f msg <span class="string">"xxx"</span></code>. The function returns 0 or 1 line to reply to sender.
    The function can raise Fail to indicate failure<br>
</div>

<pre><span id="VALmake_simple_l"><span class="keyword">val</span> make_simple_l</span> : <code class="type">?descr:string -><br>       ?prio:int -><br>       prefix:string -> (<a href="Core.html#TYPEprivmsg">Core.privmsg</a> -> string -> string list Lwt.t) -> <a href="Command.html#TYPEt">t</a></code></pre><div class="info ">
Same as <a href="Command.html#VALmake_simple"><code class="code"><span class="constructor">Command</span>.make_simple</code></a> but replies lines
    The function can raise Fail to indicate failure<br>
</div>

<pre><span id="VALmake_simple_query_l"><span class="keyword">val</span> make_simple_query_l</span> : <code class="type">?descr:string -><br>       ?prio:int -><br>       prefix:string -> (<a href="Core.html#TYPEprivmsg">Core.privmsg</a> -> string -> string list Lwt.t) -> <a href="Command.html#TYPEt">t</a></code></pre><div class="info ">
Same as <a href="Command.html#VALmake_simple_l"><code class="code"><span class="constructor">Command</span>.make_simple_l</code></a> but replies lines in query (private)
    The function can raise Fail to indicate failure<br>
</div>

<pre><span id="VALcompare_prio"><span class="keyword">val</span> compare_prio</span> : <code class="type"><a href="Command.html#TYPEt">t</a> -> <a href="Command.html#TYPEt">t</a> -> int</code></pre><div class="info ">
Compare by priority. Used to sort a list of commands by their priority.<br>
</div>

<pre><span id="VALrun"><span class="keyword">val</span> run</span> : <code class="type"><a href="Core.html#TYPEt">Core.t</a> -> <a href="Command.html#TYPEt">t</a> list -> <a href="Core.html#TYPEprivmsg">Core.privmsg</a> -> unit Lwt.t</code></pre><div class="info ">
Execute the commands, in given order, on the message. First command
    to succeed shortcuts the other ones.<br>
</div>
</body></html>